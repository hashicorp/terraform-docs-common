---
page_title: Stacks - API Docs - HCP Terraform
description: >-
  Use these endpoints to manage and interact with stacks.
---

[200]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/200

[201]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/201

[202]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/202

[204]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/204

[400]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400

[401]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401

[403]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/403

[404]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404

[409]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/409

[412]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/412

[422]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/422

[429]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429

[500]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/500

[504]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/504

[JSON API document]: /terraform/cloud-docs/api-docs#json-api-documents

[JSON API error object]: http://jsonapi.org/format/#error-objects

# Stacks API

Stacks represent collections of components, replicated across one or more deployments.

## Overview

## List stacks in a project

This endpoint lists stacks in the organization.

`GET /organizations/:organization_name/stacks`

-> **Note:** Stack read access is restricted to users or teams with read project access and the [organization API token](/terraform/cloud-docs/users-teams-organizations/api-tokens#organization-api-tokens).

| Parameter            | Description                                             |
| -------------------- | ------------------------------------------------------- |
| `:organization_name` | The name of the organization to list the stacks of. |


### Sample Request

```shell
curl \
  --header "Authorization: Bearer $TOKEN" \
  --header "Content-Type: application/vnd.api+json" \
  https://app.terraform.io/api/v2/orgnizations/my-organization/stacks
```

### Sample Response

```json
{
    "data": [
        {
            "id": "st-LSqektntTNJrAhCt",
            "type": "stacks",
            "attributes": {
                "name": "pet-nulls-stack",
                "description": null,
                "deployment-names": [
                    "complex",
                    "simple"
                ],
                "vcs-repo": {
                    "branch": "",
                    "tags-regex": null,
                    "sparse-checkout-pattern": "",
                    "identifier": "hashicorp-guides/pet-nulls-stack",
                    "display-identifier": "hashicorp-guides/pet-nulls-stack",
                    "oauth-token-id": "ot-t3remoFJPeuLk1Mz",
                    "repository-http-url": "https://github.com/hashicorp-guides/pet-nulls-stack",
                    "service-provider": "github",
                    "trigger-disabled": false
                },
                "speculative-enabled": false,
                "errors-count": 0,
                "warnings-count": 0,
                "created-at": "2024-11-19T15:19:42.478Z",
                "updated-at": "2024-12-02T22:53:04.324Z",
                "deleteable": false,
                "upstream-count": 0,
                "downstream-count": 0,
                "inputs-count": 0,
                "outputs-count": 0
            },
            "relationships": {
                "project": {
                    "data": {
                        "id": "prj-18PG93QyqCMhLhWT",
                        "type": "projects"
                    }
                },
                "agent-pool": {
                    "data": null
                },
                "latest-stack-configuration": {
                    "data": {
                        "id": "stc-JVSpXETijAH7tNLv",
                        "type": "stack-configurations"
                    }
                },
                "stack-diagnostics": {
                    "links": {
                        "related": "/api/v2/stacks/st-LSqektntTNJrAhCt/stack-diagnostics"
                    }
                }
            },
            "links": {
                "self": "/api/v2/stacks/st-LSqektntTNJrAhCt"
            }
        }
    ],
    "links": {
        "self": "https://localhost/api/v2/organizations/hashicorp/stacks?page%5Bnumber%5D=1&page%5Bsize%5D=20",
        "first": "https://localhost/api/v2/organizations/hashicorp/stacks?page%5Bnumber%5D=1&page%5Bsize%5D=20",
        "prev": null,
        "next": null,
        "last": "https://localhost/api/v2/organizations/hashicorp/stacks?page%5Bnumber%5D=1&page%5Bsize%5D=20"
    },
    "meta": {
        "pagination": {
            "current-page": 1,
            "page-size": 20,
            "prev-page": null,
            "next-page": null,
            "total-pages": 1,
            "total-count": 1
        }
    }
}
```

## Show a Stack
TODO

This endpoint returns details of the specified stack.

## List Stack Configurations
TODO

This endpoint lists all the configurations under the specified stack.

## Show Stack Configuration
TODO

This endpoint returns details of the specified stack configuration.

## List Stack Deployments
TODO

This endpoint lists all the deployments under the specified stack.

## Show Stack Deployment
TODO

This endpoint returns details of the specified stack deployment under the stack.

## List Stack Diagnostics
TODO

This endpoint lists all the diagnostics under the specified stack.

## List Stack Diagnostics under a configuration
TODO

This endpoint lists all the diagnostics under the specified stack configuration.

## Show Stack Diagnostic
TODO

This endpoint returns details of the specified stack diagnostic.

## List Stack Plans
TODO

This endpoint lists all the plans under the specified stack.

## List Stack Plans under a configuration
TODO

This endpoint lists all the plans under the specified stack configuration.

## List Stack States
TODO 

This endpoint lists all the states under the specified stack.

## Create a stack

This endpoint creates a stack.

`POST /stacks`

-> **Note:** Stack create access is restricted to users who maintain the specified project, the owners team, teams with the "Manage all projects" permission, and the [organization API token](/terraform/cloud-docs/users-teams-organizations/api-tokens#organization-api-tokens).

### Request Body

This POST endpoint requires a JSON object with the following properties as a request payload.

Properties without a default value are required.

| Key path                                        | Type    | Default   | Description |
| --- | --- | --- | --- |
| `data.type` | string | | Must be `"stacks"`. |
| `data.attributes.name` | string | | The name of the stack, which can only include letters, numbers, `-`, and `_`. This will be used as an identifier and must be unique in the project. |
| `data.attributes.description` | string | (nothing) | A description for the stack. |
| `data.attributes.vcs-repo` | object | | Settings for the stack's VCS repository. |
| `data.attributes.vcs-repo.branch` | string | (nothing) | The repository branch used by this stack's configuration. If omitted or submitted as an empty string, this defaults to the repository's default branch (e.g. `main`). |
| `data.attributes.vcs-repo.identifier` | string | | A reference to your VCS repository in the format :org/:repo where :org and :repo refer to the organization and repository in your VCS provider. |
| `data.attributes.vcs-repo.oauth-token-id` | string | | The VCS Connection (OAuth Connection + Token) to use. This ID can be obtained from the [oauth-tokens](/terraform/cloud-docs/api-docs/oauth-tokens) endpoint. |
| `data.relationships.project.data.id` | string | | The ID of the project to create the stack in. You must have permission to manage the project, either by organization-level permissions or team admin access to a specific project. |

| Status | Response | Reason |
| --- | --- | --- |
| [201][] | [JSON API document][] (`type: "stacks"`) | Successfully created a stack. |
| [404][] | [JSON API error object][] | Not found, or the user is unauthorized to perform this action. |
| [422][] | [JSON API error object][] | Malformed request body (e.g., missing attributes, wrong types, etc.). |
| [500][] | [JSON API error object][] | Internal system failure. |

### Sample Payload

```json
{
  "data": {
    "attributes": {
      "vcs-repo": {
        "identifier": "my-organization/basic-stack",
        "oauth-token-id": "ot-hmAyP66qk2AMVdbJ",
        "branch": ""
      },
      "name": "basic-stack",
      "description": "Example stack for documentation"
    },
    "relationships": {
      "project": {
        "data": {
          "type": "projects",
          "id": "prj-jT92VLSFpv8FwKtc",
        }
      }
    },
    "type": "stacks"
  }
}

```

### Sample Request

```shell
curl \
  --header "Authorization: Bearer $TOKEN" \
  --header "Content-Type: application/vnd.api+json" \
  --request POST \
  --data @payload.json \
  https://app.terraform.io/api/v2/stacks
```

### Sample Response

```json
{
  "data": {
    "id": "st-8owEfTCMQShdQ8Lb",
    "type": "stacks",
    "attributes": {
      "name": "basic-stack",
      "description": "Example stack for documentation"
      "deployment-names": [],
      "vcs-repo": {
        "branch": "",
        "identifier": "my-organization/basic-stack",
        "display-identifier": "my-organization/basic-stack",
        "oauth-token-id": "ot-hmAyP66qk2AMVdbJ",
        "repository-http-url": "https://github.com/my-organization/basic-stack",
        "service-provider": "github"
      },
      "created-at": "2024-06-12T21:25:37.504Z",
      "updated-at": "2024-06-12T21:25:37.504Z"
    },
    "relationships": {
      "project": {
        "data": {
          "id": "prj-AeuWVcVZVFGFgSbk",
          "type": "projects"
        }
      },
      "latest-stack-configuration": {
        "data": null
      },
      "stack-diagnostics": {
        "links": {
          "related": "/api/v2/stacks/st-8owEfTCMQShdQ8Lb/stack-diagnostics"
        }
      }
    },
    "links": {
      "self": "/api/v2/stacks/st-8owEfTCMQShdQ8Lb"
    }
  }
}
```

## Fetch the latest configuration for a stack

This endpoint forces a stack to pull a new configuration from it's underlying git repo.

`POST /stacks/:stack_id/actions/update-configuration`

| Parameter            | Description                                             |
| -------------------- | ------------------------------------------------------- |
| `:stack_id` | The stack id to fetch the latest configuration for. |


### Sample Request

```shell-session
$ curl \
  --header "Authorization: Bearer $TOKEN" \
  --header "Content-Type: application/vnd.api+json" \
  --request POST \
  https://app.terraform.io/api/v2/stacks/st-SihZTyXKfNXUWuUa/actions/update-configuration
```

### Sample Response

```json
{
    "data": {
        "id": "st-LSqektntTNJrAhCt",
        "type": "stacks",
        "attributes": {
            "name": "pet-nulls-stack",
            "description": null,
            "deployment-names": [
                "complex",
                "simple"
            ],
            "vcs-repo": {
              "branch": "",
              "tags-regex": null,
              "sparse-checkout-pattern": "",
              "identifier": "hashicorp-guides/pet-nulls-stack",
              "display-identifier": "hashicorp-guides/pet-nulls-stack",
              "oauth-token-id": "ot-t3remoFJPeuLk1Mz",
              "repository-http-url": "https://github.com/hashicorp-guides/pet-nulls-stack",
              "service-provider": "github",
              "trigger-disabled": false
            },
            "speculative-enabled": false,
            "created-at": "2024-11-19T15:19:42.478Z",
            "updated-at": "2025-02-06T19:30:42.222Z",
            "deleteable": false,
            "upstream-count": 0,
            "downstream-count": 0,
            "inputs-count": 0,
            "outputs-count": 0
        },
        "relationships": {
            "project": {
                "data": {
                    "id": "prj-18PG93QyqCMhLhWT",
                    "type": "projects"
                }
            },
            "agent-pool": {
                "data": null
            },
            "latest-stack-configuration": {
                "data": {
                    "id": "stc-4DiYHNJZCFq8pkXq",
                    "type": "stack-configurations"
                }
            },
            "stack-diagnostics": {
                "links": {
                    "related": "/api/v2/stacks/st-LSqektntTNJrAhCt/stack-diagnostics"
                }
            }
        },
        "links": {
            "self": "/api/v2/stacks/st-LSqektntTNJrAhCt"
        }
    }
}
```

## Acknowledge a Stack Diagnostic
TODO

This endpoint acknowledges the specified stack diagnostic.

## Modify a stack's settings

TODO

## Delete an empty stack

When you delete an HCP Terraform Stack with resources, Terraform can no longer track or manage that infrastructure. During a safe delete, HCP Terraform only deletes the stack if it is not managing resources.

`POST /stacks/:stack_id/delete`

| Parameter            | Description                                             |
| -------------------- | ------------------------------------------------------- |
| `:stack_id` | The stack id to delete. |

### Sample Request

```shell-session
$ curl \
  --header "Authorization: Bearer $TOKEN" \
  --header "Content-Type: application/vnd.api+json" \
  --request DELETE \
  https://app.terraform.io/api/v2/stacks/st-SihZTyXKfNXUWuUa/delete
```

| Status  | Response                  | Reason(s)                                                             |
| ------- | --------------------------| --------------------------------------------------------------------- |
| [204][] | No Content                | Successfully deleted the stack                                    |
| [404][] | [JSON API error object][] | Stack not found, or user unauthorized to perform stack delete |
| [409][] | [JSON API error object][] | Stack is not safe to delete because it is managing resources                                       |

## Force-Delete a stack

During a force delete, HCP Terraform removes the specified stack without checking whether it has any deployments that are managing resources. We recommend using the [safe delete endpoint](#Delete-an-empty-stack) instead, when possible.
